# Pan-cancer associations with drug response

```{r setup3, include=FALSE}
library(cowplot)
library(dplyr)
util = import('./util_3')
followup = import('../analyses/drug_assocs_followup/util')

tt = theme(text = element_text(size = 8))

mapk_mut_pathway = util$stratify("MAPK", c("BRAF", "NRAS", "KRAS"))
mapk_braf_pathway = util$stratify("MAPK", "BRAF")
p53_mut_pathway = util$stratify("p53", "TP53")
```

## Associations between pathway scores and drug response

### Signaling Footprints (SPEED, speed_matrix)

```{r volcano_speed_matrix, echo=FALSE, fig.cap='Footprints drug associations'}
util$volcano("speed_matrix")
```

### Gene Ontology (GSEA)

```{r volcano_go, echo=FALSE, fig.cap='Gene Ontology drug associations'}
util$volcano("gsea_go")
```

### Reactome (GSEA)

```{r volcano_reactome, echo=FALSE, fig.cap='Reactome drug associations'}
util$volcano("gsea_reactome")
```

### BioCarta (GSEA)

```{r volcano_biocarta, echo=FALSE, fig.cap='BioCarta drug associations'}
util$volcano("gsea_biocarta")
```

### SPIA

```{r volcano_spia, echo=FALSE, fig.cap='SPIA drug associations'}
util$volcano("spia")
```

### Pathifier

```{r volcano_pathifier, echo=FALSE, fig.cap='Pathifier drug associations'}
util$volcano("pathifier")
```

### PARADIGM

```{r volcano_paradigm, echo=FALSE, fig.cap='PARADIGM drug associations'}
util$volcano("paradigm")
```


## Improvement of mutation biomarkers using pathway scores

### Trametinib + MAPK

#### Linear Fit behind Associations
```{r tram_mapk_fit, echo=FALSE, fig.width=5, fig.height=3, fig.cap='Linear fit for MAPK + Trametinib'}
mydf = util$create_df("MAPK", c("KRAS","NRAS","BRAF"), "Trametinib")
util$linear_fit(mydf)
```

####  Stratifications compared to the different tissues
```{r tram_mapk_cmp, echo=FALSE, fig.cap='Comparison of stratifications'}
mut_only = followup$drug_range_box("Trametinib", stratify=list(Pancan=mapk_mut_pathway[1:3])) + tt
speed_only = followup$drug_range_box("Trametinib", stratify=list(Pancan=mapk_mut_pathway[4:6])) + tt
wt_speed = followup$drug_range_box("Trametinib", stratify=list(Pancan=mapk_mut_pathway[7:9])) + tt
mut_speed = followup$drug_range_box("Trametinib", stratify=list(Pancan=mapk_mut_pathway[10:12])) + tt

plot_grid(mut_only, speed_only, wt_speed, mut_speed,
    labels = c("KRAS or NRAS or BRAF mut", "MAPK pathway score",
               "wt + pathway", "mut + pathway"),
    label_size = 10, align = "h")
```

#### Number of Cell Lines in each Set
```{r tram_mapk_nums, echo=FALSE}
print(table(stack(mapk_mut_pathway)$ind))
```

#### Statistics about the Stratifications
```{r tram_mapk_stats, echo=FALSE}
print(util$contrast_stats(mapk_mut_pathway, "Trametinib", "MAPK"))
```


### AZ628 + MAPK

#### Linear Fit behind Associations
```{r az_mapk_fit, echo=FALSE, fig.width=5, fig.height=3, fig.cap='Linear fit for MAPK + AZ628'}
mydf = util$create_df("MAPK", c("KRAS","NRAS","BRAF"), "AZ628")
util$linear_fit(mydf)
```

####  Stratifications compared to the different tissues
```{r az_mapk_cmp, echo=FALSE, fig.cap='Comparison of stratifications'}
mut_only = followup$drug_range_box("AZ628", stratify=list(Pancan=mapk_mut_pathway[1:3])) + tt
speed_only = followup$drug_range_box("AZ628", stratify=list(Pancan=mapk_mut_pathway[4:6])) + tt
wt_speed = followup$drug_range_box("AZ628", stratify=list(Pancan=mapk_mut_pathway[7:9])) + tt
mut_speed = followup$drug_range_box("AZ628", stratify=list(Pancan=mapk_mut_pathway[10:12])) + tt

plot_grid(mut_only, speed_only, wt_speed, mut_speed,
    labels = c("KRAS or NRAS or BRAF mut", "MAPK pathway score",
               "wt + pathway", "mut + pathway"),
    label_size = 10, align = "h")
```

#### Number of Cell Lines in each Set
```{r az_mapk_nums, echo=FALSE}
print(table(stack(mapk_mut_pathway)$ind))
```

#### Statistics about the Stratifications
```{r az_mapk_stats, echo=FALSE}
print(util$contrast_stats(mapk_mut_pathway, "AZ628", "MAPK"))
```


### Dabrafenib + MAPK / BRAF

#### Linear Fit behind Associations
```{r da_braf_fit, echo=FALSE, fig.width=5, fig.height=3, fig.cap='Linear fit for MAPK + Dabrafenib'}
mydf = util$create_df("MAPK", "BRAF", "Dabrafenib")
util$linear_fit(mydf)
```

####  Stratifications compared to the different tissues
```{r da_braf_cmp, echo=FALSE, fig.cap='Comparison of stratifications'}
mut_only = followup$drug_range_box("Dabrafenib", stratify=list(Pancan=mapk_braf_pathway[1:3])) + tt
speed_only = followup$drug_range_box("Dabrafenib", stratify=list(Pancan=mapk_braf_pathway[4:6])) + tt
wt_speed = followup$drug_range_box("Dabrafenib", stratify=list(Pancan=mapk_braf_pathway[7:9])) + tt
mut_speed = followup$drug_range_box("Dabrafenib", stratify=list(Pancan=mapk_braf_pathway[10:12])) + tt

plot_grid(mut_only, speed_only, wt_speed, mut_speed,
    labels = c("BRAF mut", "MAPK pathway score",
               "wt + pathway", "mut + pathway"),
    label_size = 10, align = "h")
```

#### Number of Cell Lines in each Set
```{r da_braf_nums, echo=FALSE}
print(table(stack(mapk_braf_pathway)$ind))
```

#### Statistics about the Stratifications
```{r da_braf_stats, echo=FALSE}
print(util$contrast_stats(mapk_braf_pathway, "Dabrafenib", "MAPK", "BRAF"))
```


### Nutlin-3a + p53

#### Linear Fit behind Associations
```{r p53_fit, echo=FALSE, fig.width=5, fig.height=3, fig.cap='Linear fit for p53 + Nutlin-3a'}
mydf = util$create_df("p53", "TP53", "Nutlin-3a")
util$linear_fit(mydf)
```

####  Stratifications compared to the different tissues
```{r p53_cmp, echo=FALSE, fig.cap='Comparison of stratifications'}
mut_only = followup$drug_range_box("Nutlin-3a", stratify=list(Pancan=p53_mut_pathway[1:3])) + tt
speed_only = followup$drug_range_box("Nutlin-3a", stratify=list(Pancan=p53_mut_pathway[4:6])) + tt
wt_speed = followup$drug_range_box("Nutlin-3a", stratify=list(Pancan=p53_mut_pathway[7:9])) + tt
mut_speed = followup$drug_range_box("Nutlin-3a", stratify=list(Pancan=p53_mut_pathway[10:12])) + tt

plot_grid(mut_only, speed_only, wt_speed, mut_speed,
    labels = c("TP53 mut", "p53 pathway score",
               "wt + pathway", "mut + pathway"),
    label_size = 10, align = "h")
```

#### Number of Cell Lines in each Set
```{r p53_nums, echo=FALSE}
print(table(stack(p53_mut_pathway)$ind))
```

#### Statistics about the Stratifications
```{r p53_stats, echo=FALSE}
print(util$contrast_stats(p53_mut_pathway, "Nutlin-3a", "p53", "TP53"))
```


## Discussion

... write some thoughts here ...
