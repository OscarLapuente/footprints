---
title: "Pan-cancer improvements with mutations and MAPK scores"
author: "Michael Schubert (schubert@ebi.ac.uk)"
---

```{r code, include=FALSE}
library(cowplot)
library(dplyr)
util = import('./util_3')
followup = import('../analyses/drug_assocs_followup/util')

tt = theme(text = element_text(size = 8))

mapk_mut_pathway = util$stratify("MAPK", c("BRAF", "NRAS", "KRAS"))
mapk_braf_pathway = util$stratify("MAPK", "BRAF")
p53_mut_pathway = util$stratify("p53", "TP53")
```

# Volcano Plots

## SPEED

```{r volcano_speed_matrix, echo=FALSE}
util$volcano("speed_matrix")
```

## GO

```{r volcano_go, echo=FALSE}
util$volcano("gsea_go")
```

## Reactome

```{r volcano_reactome, echo=FALSE}
util$volcano("gsea_reactome")
```

## BioCarta

```{r volcano_biocarta, echo=FALSE}
util$volcano("gsea_biocarta")
```

## SPIA

```{r volcano_spia, echo=FALSE}
util$volcano("spia")
```

## Pathifier

```{r volcano_pathifier, echo=FALSE}
#util$volcano("pathifier") #FIXME: not there yet, why?
```

## PARADIGM

```{r volcano_paradigm, echo=FALSE}
util$volcano("paradigm")
```

# Trametinib + MAPK

### Linear Fit behind Associations
```{r tram_mapk_fit, echo=FALSE, fig.width=5, fig.height=3}
mydf = util$create_df("MAPK", c("KRAS","NRAS","BRAF"), "Trametinib")
util$linear_fit(mydf)
```

###  Stratifications compared to the different tissues
```{r tram_mapk_cmp, echo=FALSE}
mut_only = followup$drug_range_box("Trametinib", stratify=list(Pancan=mapk_mut_pathway[1:3])) + tt
speed_only = followup$drug_range_box("Trametinib", stratify=list(Pancan=mapk_mut_pathway[4:6])) + tt
wt_speed = followup$drug_range_box("Trametinib", stratify=list(Pancan=mapk_mut_pathway[7:9])) + tt
mut_speed = followup$drug_range_box("Trametinib", stratify=list(Pancan=mapk_mut_pathway[10:12])) + tt

plot_grid(mut_only, speed_only, wt_speed, mut_speed,
    labels = c("KRAS or NRAS or BRAF mut", "MAPK pathway score",
               "wt + pathway", "mut + pathway"),
    label_size = 10, align = "h")
```

### Number of Cell Lines in each Set
```{r tram_mapk_nums, echo=FALSE}
print(table(stack(mapk_mut_pathway)$ind))
```

### Statistics about the Stratifications
```{r tram_mapk_stats, echo=FALSE}
print(util$contrast_stats(mapk_mut_pathway, "Trametinib", "MAPK"))
```

# AZ628 + MAPK

```{r az_mapk, echo=FALSE}
mut_only = followup$drug_range_box("AZ628", stratify=list(Pancan=mapk_mut_pathway[1:3])) + tt
speed_only = followup$drug_range_box("AZ628", stratify=list(Pancan=mapk_mut_pathway[4:6])) + tt
wt_speed = followup$drug_range_box("AZ628", stratify=list(Pancan=mapk_mut_pathway[7:9])) + tt
mut_speed = followup$drug_range_box("AZ628", stratify=list(Pancan=mapk_mut_pathway[10:12])) + tt

plot_grid(mut_only, speed_only, wt_speed, mut_speed,
    labels = c("KRAS or NRAS or BRAF mut", "MAPK pathway score",
               "wt + pathway", "mut + pathway"),
    label_size = 10, align = "h")
```

# Dabrafenib + MAPK / BRAF

```{r da_braf, echo=FALSE}
mut_only = followup$drug_range_box("Dabrafenib", stratify=list(Pancan=mapk_braf_pathway[1:3])) + tt
speed_only = followup$drug_range_box("Dabrafenib", stratify=list(Pancan=mapk_braf_pathway[4:6])) + tt
wt_speed = followup$drug_range_box("Dabrafenib", stratify=list(Pancan=mapk_braf_pathway[7:9])) + tt
mut_speed = followup$drug_range_box("Dabrafenib", stratify=list(Pancan=mapk_braf_pathway[10:12])) + tt

plot_grid(mut_only, speed_only, wt_speed, mut_speed,
    labels = c("BRAF mut", "MAPK pathway score",
               "wt + pathway", "mut + pathway"),
    label_size = 10, align = "h")
```

# Nutlin-3a + p53

```{r p53, echo=FALSE}
mut_only = followup$drug_range_box("Nutlin-3a", stratify=list(Pancan=p53_mut_pathway[1:3])) + tt
speed_only = followup$drug_range_box("Nutlin-3a", stratify=list(Pancan=p53_mut_pathway[4:6])) + tt
wt_speed = followup$drug_range_box("Nutlin-3a", stratify=list(Pancan=p53_mut_pathway[7:9])) + tt
mut_speed = followup$drug_range_box("Nutlin-3a", stratify=list(Pancan=p53_mut_pathway[10:12])) + tt

plot_grid(mut_only, speed_only, wt_speed, mut_speed,
    labels = c("TP53 mut", "p53 pathway score",
               "wt + pathway", "mut + pathway"),
    label_size = 10, align = "h")
```
